
アーキテクチャ
#############

  氏名漢字カナ突合モデルは，Javaのモジュールとして提供される。氏名漢字カナ突合モデルは，氏名漢字カナ突合機能，氏名カタカナ推計機能，氏名漢字推計機能を有するが，氏名漢字カナ突合機能のアーキテクチャについて説明する。

  なお，氏名カタカナ推計機能，氏名漢字推計機能はAIモデルを用いた推計のみを行っている。


構成要素
========
  氏名漢字カナ突合機能は，ストラテジパターンを用いて構築されている。氏名漢字カナ突合機能は，簡易モデルと詳細モデルという２つのストラテジーを用いている。ストラテジはモデルを組み合わせることで構成され，モデルはエンジンを組み合わせることで構成される。
  
  また，それぞれのエンジンは辞書など外部であらかじめ定義された辞書データを用いながら，漢字・アルファベットとカタカナの突合を行っている。

ストラテジ
-----

  ストラテジは，モデルの組み合わせで構成され，モデルは，漢字とカナを単語（文字）単位で突合する機能である。エンジンは，漢字とカナのペアが辞書にあるかどうかで一致を判定するものや，漢字をAIでカナ推定した結果に入力のカナが含まれるかで一致の判定をおこなうもの，などがある

  .. figure:: img/strategy.png
     :align: center

     ストラテジ，モデル，エンジンの概念

モデル・エンジン
----

  同一のモデル内では基本的に前の結果を引き継ぎ，一致と判定されなかった部分を後続のエンジンで判定する。

  .. figure:: img/model.png
     :align: center
     :scale: 50%

     モデル，エンジンの概念


  氏名漢字カナ突合モデルにおいては，氏名の漢字・アルファベットとカタカナを突合するためには，具体的に次のモデル，エンジンを用いる。エンジンの詳細については。 :doc:`algorithm` を参照のこと。

  * 辞書モデル（ルールベースモデル）
     あらかじめ，漢字・アルファベットとカタカナのペアで作成した辞書を用いて，突合ルールに従い突合を行う手法である。

    * 姓名辞書エンジン
       漢字・アルファベットとカタカナのペアを単語単位で ``姓名辞書`` として作成する。見出しには，漢字・アルファベット，読みにカタカナを複数持つことで， 例えば ``幸子`` という漢字名に対して ``サチコ`` 及び ``ユキコ`` の読みに対しても，一致していると判断することが可能となる。

    * 単漢字辞書エンジン
       単漢字辞書として，漢字・アルファベット一文字に対して，読みであるカタカナを複数持つ ``単漢字辞書`` を作成する。単語単位で突合できなかった漢字・アルファベットとカタカナのペアに対して，漢字・アルファベットを一文字ずつに分解しながら，カタカナと突合することで， ``姓名辞書`` では突合できなかった姓名についても，突合可能となる。

    * 異体字辞書エンジン
       異体字とは，渡辺の ``辺`` のように， ``渡邉`` や ``渡邊`` のように，同じ ``辺`` でも，複数の字体が存在するものに対して対応するために， ``辺`` と ``邉`` と ``邊`` のペアで作成した異体字辞書である。この ``異体字辞書`` は姓名辞書モデル，単漢字辞書モデルで，異体字があれば適宜置き換えて突合を行う

    * アルファベットエンジン
       アルファベット姓名とカタカナ姓名を入力とし， 日本語(ローマ字表記) - 英語表記 部分対応表をもとに，突合を行う。詳細は  `佐藤 理史. 2020 東京オリンピック参加者名簿の翻訳. 自然言語処理, Vol.30, No.2, pp748-772, 2023.  <https://www.jstage.jst.go.jp/article/jnlp/30/2/30_748/_article/-char/ja>`_  を参照のこと。

  * 統計モデル
     漢字・アルファベット姓名とカタカナ姓名の組み合わせで，その組み合わせで間違いを含むものを有する大量データから，単語分割した漢字・アルファベットとカタカナのペアを，どの組み合わせが何組あるかを，集計した辞書を作成する。その辞書を用い，入力された漢字・アルファベットとカタカナの組み合わせ数が，その辞書内に，ある閾値以上（例えば４組以上）ある場合には，漢字・アルファベットとカタカナの組み合わせは正しいと判断する。

     なお，氏名漢字カナ突合モデルでは，ソースコードには存在するが，こちらの統計モデルはデータを空にしているため，実際には使用していない。

  * AIモデル
     Seq2Seq+Transformerのモデルを用いて，入力に漢字・アルファベット姓名，出力にカタカナ姓名を与えて学習させる。入力，及び出力は，文字単位で分割し，その並びを学習させる。Transformerのハイパーパラメタなどは `こちら <https://github.com/digital-go-jp/kanjikana-model/tree/main/train>`_ を参照のこと。
   


辞書
----

  辞書は漢字姓名とカナ姓名のマッチングを判定するために利用し，下記の種類がある

  - 姓名辞書　
    漢字・アルファベット姓名に対するカナ姓名の一覧が記載された辞書であり，漢字・アルファベットの単語単位に，複数のカタカナが羅列されている。 

      ===== =============
      漢字   カタカナ  
      ===== =============
      幸子   サチコ　ユキコ
      雪子   ユキコ
      ...   ...
      ===== =============

  - 単漢字辞書
    漢字やアルファベット一文字とその読みであるカタカナが複数羅列されている。

      ===== =============
      漢字   カタカナ  
      ===== =============
      幸     シアワ　サチ
      雪     ユキ　セツ
      ===== =============

  - 異体字辞書
    ある漢字の異体字がある場合には，異体字の一覧が記載されたもの。異体字が例えば３個あれば，それぞれが見出しとなる辞書が3行作成される。

      ===== =============
      漢字   異体字
      ===== =============
      辺     邉　邊
      邉     邊　辺
      邊     辺　邉
      ===== =============

  - 統計辞書
    大量の漢字・アルファベットとカタカナのペアデータから作成された，単語単位のペアと，その組み合わせの数を記載したもの。

      ===== ============= =======
      漢字   カタカナ       組合数
      ===== ============= =======
      幸子   サチコ         10000
      幸子   ユキコ         5000
      ...   ...           ...
      ===== ============= =======


前処理
=========

  漢字・アルファベットは， :doc:`../api/data` に記載している５つのパターンを許容する。入力データは，ストラテジに入力する前に，複数個の漢字・アルファベット姓名とカタカナ姓名のペアに分解されて，ストラテジに順次入力し突合を行う。

  - 別名を持つパターン
     例） 日本　花子（東京　雪子），トウキョウ　ユキコ

     「日本　花子，トウキョウ　ユキコ」 と「東京　雪子，トウキョウ　ユキコ」の２つに分解される

  - 旧姓を持つパターン
     例）日本［東京］　花子，トウキョウ　ハナコ

     「日本　花子，トウキョウ　ハナコ」 と「東京　花子，トウキョウ　ハナコ」の２つに分解される

  - アルファベット名及び別名を持つパターン
     例）JAPAN　FLOWER＿日本　花子（東京　雪子），トウキョウ　ユキコ

     「JAPAN　FLOWER，トウキョウ　ユキコ」と 「日本　花子，トウキョウ　ユキコ」 と「東京　雪子，トウキョウ　ユキコ」の３つに分解される。


