氏名漢字カナ突合モデル
####################


機能
====

  氏名漢字カナ突合モデルはJavaで構築されたモジュールである。氏名漢字カナ突合機能，氏名カタカナ推計機能，氏名漢字推計機能を有する。
  モジュール単体では，ファイル形式で入力を受け取り，結果をファイル形式，もしくはコンソールに出力する。

  * 氏名漢字カナ突合機能
    
    * 仕様

      漢字姓名（アルファベット姓名）とカナ姓名を入力し，一致しているかどうかの判定結果を返す。後述の，辞書モデル，統計モデル，AIモデルを用いて判定する。その一致判定結果を数値０−９９の範囲で返却する。

    * 入力する漢字，カタカナ姓名の仕様

      漢字姓名は，マイナンバーカードの券面情報をそのまま入力とする。詳細なフォーマットについては， :doc:`../api/data` を参照のこと。

    * 判定に利用するモデル

      大きく分けて，漢字とカナの突合判定に時間のかからない「簡易モデル」と，詳細に漢字とかなの突合判定を行う「詳細モデル」の２種類とする。

  * 氏名カタカナ推計機能

    * 仕様

      漢字姓名（アルファベット姓名）と推計するカタカナの個数を入力し，カタカナ姓名の候補一覧を返す。後述の，AIモデルを用いて推計する。推計されるカタカナ姓名は，アルゴリズムから推計されるそのカタカナ姓名確率が高い順に，指定された個数個を返却する。
 
    * 入力する漢字姓名の仕様

      入力する漢字姓名は，漢字姓名を全角文字でスペースで区切ったものを入力する。例えば「日本　一郎」や「ＢＩＬＬＹ　ＪＯＥＬ」という形で入力する。なお，ミドルネームはいくつあっても良い。
      
    * 判定に利用するモデル

      漢字姓名からカナ姓名を推測するために，漢字姓名とカナ姓名のペアを入力とした，ディープラーニングモデル（Seq2Seq+Transformer）を用いてあらかじめ学習済みのモデルを用いて，推測を行うこととする。

  * 氏名漢字推計機能

    * 仕様

      カナ姓名を入力し，漢字姓名（アルファベット姓名）の候補一覧を返す。後述の，AIモデルを用いて推計する。推計される漢字・アルファベット姓名は，アルゴリズムから推計されるその漢字・アルファベット姓名確率が高い順に，指定された個数個を返却する。

    * 入力するカタカナ姓名の仕様

      入力するカタカナ姓名は，カタカナ姓名を全角文字でスペースで区切ったものを入力する。例えば「ニッポン　イチロウ」や「ビリー　ジョエル」という形で入力する。なお，ミドルネームはいくつあっても良い。

    * 判定に利用するモデル

      カタカナ姓名からカナ姓名を推測するために，カナ姓名と漢字姓名のペアを入力とした，ディープラーニングモデル（Seq2Seq+Transformer）を用いてあらかじめ学習済みのモデルを用いて，推測を行うこととする。


ソースコード
==========

  本モデルのソースコードは `Github <https://github.com/digital-go-jp/kanjikanaa-model/>`_ に格納されている


アーキテクチャ
=======

  * 概要

    氏名漢字カナ突合モデルは，漢字とカナの一致を判定するために，漢字とカナのペアで作成した辞書を予め用意しておき，これらとマッチングすることで一致不一致を判定する。また，予め漢字姓名とカナ姓名のペアを用いて，事前学習させたディープラーニングモデル（Seq2Seq＋Transformer）を用いて，漢字からカナ姓名もしくは，カナから漢字姓名を推計するモデルも併せて用いる。

    なお，氏名漢字カナ突合モデルのアーキテクチャ，アルゴリズム等の詳細については， :doc:`architecture` を参照のこと。

  * 前提条件

    * 漢字姓名フォーマットへの対応

      漢字姓名は，マイナンバーカード券面記載情報のフォーマットでの入力も想定している。そのために， :doc:`../api/data` 記載の，それぞれのフォーマットにおいても正しくマッチングする必要がある。

      - 旧姓
      - 別名
      - アルファベットと漢字姓名併記

    * 空白くぎりの対応

      入力される漢字姓名，カナ姓名において，必ずしも姓と名の間に全角スペースが入っていないパターンも考慮する必要がある。

      - 単純な間違い

        例えば漢字姓名が「田中　一郎」，カタカナ姓名が「タナ　カイチロウ」などと，全角スペースが正しい位置でない場合も存在する可能性を考慮したアルゴリズムとする

      - ミドルネームによるもの

        外国人名で複数のミドルネームを持つ人などは，アルファベットのミドルネーム通りにカタカナ名にスペースが入らない可能性がある。
        アルファベット名「TANAKA　JOHN　MANJIRO」，カタカナ名「タナカ　ジョンマンジロウ」のように，区切りが合わないパターンなど


  * 漢字カナ辞書

    辞書は姓名のペアを保持する辞書として，①オープンソースの辞書から作成した漢字とカナのペア，②Webクロールによって集めた漢字とカナ姓名のペアがある。
    
    また，単漢字辞書や異体字辞書も①オープンソースによって作成したものも合わせて使う。
    
    辞書は，漢字に対して複数のカナのペアを保持し，それぞれのペアに対して，そのペアを取得した由来（どのオープンソース辞書か，どのWebからスクレイピングしたか）などを複数保持する。

  *	ディープラーニングモデル（AIモデル）
  
    ディープラーニングモデルは，時系列を予測する手法であるSeq2Seqを用い，Transformerで，予めオープンソース辞書やクロール辞書を用いて学習させたモデルを用いて推論させることで，漢字姓名からカナ姓名，もしくは，カナ姓名から漢字姓名を予測させるものである。

    本システムでは，下記２つのAIモデルを作成した。

    - 漢字姓名からカナ姓名を推計

    - カナ姓名から漢字姓名を推計

  * 辞書マッチングアルゴリズム

    漢字姓名とカナ姓名のマッチング機能においては，漢字（アルファベット）とカナが辞書に含まれているかどうかをチェックすることでマッチングを行っている。手順としては次のとおりである。辞書の種類については次章を参照。

    #. スペースで区切り，漢字とカナを単語単位で姓名辞書とマッチング
    #. 1で漢字に異体字が入っている場合には置き換えながら，姓名辞書とマッチング
    #. マッチしなかった漢字とカナのペアは，漢字１文字とカナ（１文字or複数）が単漢字辞書とマッチング。これを繰り返し，全ての漢字とカナが一致するかどうかを判定
    #. 3で漢字に異体字が入っている場合には置き換えながら，単漢字辞書とマッチング

  * 外国人マッチングアルゴリズム

    外国人姓名である，アルファベット姓名とカタカナ姓名のマッチングは，5.5辞書マッチング以外にも，外国人モデル を用いて，判定している。アルファベットとカタカナを与えて，外国人モデルに当てはめることで，アルファベットとカタカナが一致しているかどうかを判断する。詳細のアルゴリズムは `佐藤 理史. 2020 東京オリンピック参加者名簿の翻訳. 自然言語処理, Vol.30, No.2, pp748-772, 2023. <https://www.jstage.jst.go.jp/article/jnlp/30/2/30_748/_article/-char/ja>`_ を参照のこと。

  * 統計マッチングアルゴリズム
    大量のデータを基に，漢字姓名とカナ姓名を単語単位にペアを作成した統計辞書を用いて，入力された漢字とカナのペアが統計辞書に入っているかどうかで判定する。判定においては，漢字とカナのペアが４個以上あるものは一致していると判定する。なお，統計辞書は，たまたま間違ったペアが複数個入る場合もあるため，信頼性は高くない可能性がある。

  * AIマッチングアルゴリズム

    AIモデルを用いて，漢字姓名をAIモデルに入力し，推計されたカタカナ姓名のうち，確率的に信頼度が高い上位５個に入っているかどうかで，マッチングを判定する。AI判定のために必ずしも正しい結果が返ってくるわけではなく，信頼度が高くない可能性がある。


データソース
==========

  AIモデルの作成や，氏名漢字カナ突合モデルでは，漢字・アルファベットとカタカナのペアのデータを使用している。
  これらのデータは，氏名などの漢字・アルファベットとその読みであるカタカナをペアとして作成したデータセットであり，漢字・アルファベットとカタカナは１：Nの形で保持している。

  データソースの詳細は  :doc:`datasource` を参照のこと


プログラム
========
  本氏名漢字カナ突合モデルの氏名漢字カナ突合機能のプログラムの詳細については :doc:`program` を参照のこと。



